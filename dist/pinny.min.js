/*! pinny 1.1.2 (https://github.com/mobify/pinny.git) */
(function(t){if("function"==typeof define&&define.amd)define(["$","plugin","bouncefix","velocity","lockup","shade","deckard"],t);else{var i=window.Zepto||window.jQuery;t(i,window.Plugin,window.bouncefix)}})(function(t,i,e,n){function a(t,i){a.__super__.call(this,t,i,a.DEFAULTS)}var s="Pikabu requires a declared effect to operate. For more information read: https://github.com/mobify/pikabu#initializing-the-plugin",o="a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]",r="input, select, textarea";Function.prototype.bind||(Function.prototype.bind=function(t){var i=this;return function(){return i.apply(t)}});var c=t.os.ios&&7>=t.os.major,u={PINNY:"pikabu",HEADER:"pikabu__header",WRAPPER:"pikabu__wrapper",SPACER:"pikabu__spacer",TITLE:"pikabu__title",CLOSE:"pikabu__close",CONTENT:"pikabu__content",OPENED:"pikabu--is-open",SCROLLABLE:"pikabu--is-scrollable"},h={COMPONENT:'<{0} class="'+u.PINNY+'__{0}">{1}</{0}>',HEADER:'<h1 class="'+u.TITLE+'">{0}</h1><button class="'+u.CLOSE+'">Close</button>',FOOTER:"{0}"},d={click:"click.pikabu",focus:"focus.pikabu",blur:"blur.pikabu"};return a.VERSION="1.1.2",a.DEFAULTS={effect:null,container:null,appendTo:null,structure:{header:"",footer:!1},zIndex:2,cssClass:"",coverage:"100%",easing:"swing",duration:200,shade:{},open:t.noop,opened:t.noop,close:t.noop,closed:t.noop,scrollDuration:50,spacerHeight:300},i.create("pikabu",a,{animation:{beginClose:function(){},openComplete:function(){this._trigger("opened"),this._focus()},closeComplete:function(){this._trigger("closed"),this._resetFocus()}},_init:function(i){if(this.id="pikabu-"+t.uniqueId(),this.$element=t(i),this.$doc=t(document),this.$body=t("body"),this._build(),!this.options.effect)throw s;this.effect=this.options.effect.call(this),this.$element.removeAttr("hidden"),this._bindEvents()},toggle:function(){this[this.$pikabu.hasClass(u.OPENED)?"close":"open"]()},open:function(){this._isOpen()||(this._trigger("open"),e.add(u.SCROLLABLE),this.effect.open.call(this),this.options.shade&&this.$shade.shade("open"),this.$pikabu.addClass(u.OPENED),this.$pikabu.lockup("lock"))},close:function(){this._isOpen()&&(this._trigger("close"),e.remove(u.SCROLLABLE),this.$pikabu.removeClass(u.OPENED),this.options.shade&&this.$shade.shade("close"),this.effect.close.call(this),this.$pikabu.lockup("unlock"))},_isOpen:function(){return this.$pikabu.hasClass(u.OPENED)},_bindEvents:function(){this.$pikabu.on("touchmove",function(i){t(i.target).parents().hasClass(u.CONTENT)||i.preventDefault()})},_build:function(){var i=this;if(this.$pikabu=t("<section />").addClass(u.PINNY).addClass(this.options.cssClass).css({position:"fixed",zIndex:this.options.zIndex,width:this.options.coverage,height:this.options.coverage}).on(d.click,"."+u.CLOSE,function(t){t.preventDefault(),i.close()}).lockup({container:this.options.container,locked:function(){i._handleKeyboardShown()},unlocked:function(){i._handleKeyboardHidden()}}),this.$container=this.$pikabu.data("lockup").$container,this.$pikabu.appendTo(this.options.appendTo?t(this.options.appendTo):this.$container),this.options.structure){var e=t("<div />").addClass(u.WRAPPER).appendTo(this.$pikabu);this._buildComponent("header").appendTo(e),t("<div />").addClass(u.CONTENT).addClass(u.SCROLLABLE).append(this.$element).append(this.$spacer).appendTo(e),this._buildComponent("footer").appendTo(e)}else this.$element.appendTo(this.$pikabu);this.$header=this.$pikabu.find("."+u.HEADER),this.$content=this.$pikabu.find("."+u.CONTENT),this.$spacer=t("<div />").addClass(u.SPACER).height(this.options.spacerHeight).attr("hidden","hidden").appendTo(this.$content),this._addAccessibility(),this.options.shade&&(this.$shade=this.$pikabu.shade(t.extend(!0,{},{click:function(){i.close()}},t.extend(this.options.shade,{duration:this.options.duration}))))},_buildComponent:function(i){var e=this.options.structure[i],n=t([]);if(e!==!1){var a=this._isHtml(e)?e:h[i.toUpperCase()].replace("{0}",e);n=t(h.COMPONENT.replace(/\{0\}/g,i).replace(/\{1\}/g,a))}return n},_isHtml:function(t){return/<[a-z][\s\S]*>/i.test(t)},_coverage:function(t){var i,e=this.options.coverage.match(/(\d*)%$/);return e&&(i=100-parseInt(e[1]),t&&(i/=t)),e?i+"%":this.options.coverage},_addAccessibility:function(){var t=this.id+"__header",i=this.$pikabu.find("h1, ."+u.TITLE).first(),e=this.$pikabu.find("."+u.WRAPPER);this.$container.attr("aria-hidden","false"),this.$pikabu.attr("role","dialog").attr("aria-labelledby",t).attr("aria-hidden","true").attr("tabindex","-1"),e.attr("role","document"),i.attr("id",t)},_focus:function(){this.originalActiveElement=document.activeElement,this._disableInputs(),this.$pikabu.attr("aria-hidden","false"),this.$pikabu.children().first().focus(),this.$container.attr("aria-hidden","true")},_resetFocus:function(){this._enableInputs(),this.$container.attr("aria-hidden","false"),this.$pikabu.attr("aria-hidden","true"),this.originalActiveElement.focus()},_disableInputs:function(){var i=t(o).not(function(){return t(this).closest(".pikabu").length});i.each(function(i,e){var n=t(e),a=n.attr("tabindex")||0;n.data("tabindex",a).attr("tabindex","-1")})},_enableInputs:function(){var i=t("[data-pikabu-tabindex]");i.each(function(i,e){var n=t(e),a=n.data("tabindex");a?n.attr("tabindex",a):n.removeAttr("tabindex"),n.removeData("tabindex")})},_handleKeyboardShown:function(){c&&this.$pikabu.find(r).on(d.focus,this._inputFocus.bind(this)).on(d.blur,this._inputBlur.bind(this))},_handleKeyboardHidden:function(){c&&this.$pikabu.find(r).off(d.focus).off(d.blur)},_inputFocus:function(){this.$spacer.removeAttr("hidden"),n.animate(this._scrollTarget(),"scroll",{container:this.$content[0],offset:-1*(this.$header.height()+parseInt(this.$content.css("padding-top"))),duration:this.options.scrollDuration})},_inputBlur:function(){!this._activeElement().is(r)&&this.$spacer.attr("hidden","")},_activeElement:function(){return t(document.activeElement)},_scrollTarget:function(){for(var t=this._activeElement(),i=t.parent();"relative"===i.css("position")&&!i.hasClass(u.CONTENT);)t=i,i=t.parent();return t}}),t("[data-pikabu]").each(function(){var i=t(this),e=t(this).data("pikabu");if(!e.length)throw s;i.pikabu({effect:e})}),t});